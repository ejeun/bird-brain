{% extends "components/stepbase.html" %}
{% block content %}
<style>
    .collage-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        pointer-events: none; /* Allow clicks to pass through to canvas */
    }

    .collage-item {
        position: absolute;
        cursor: pointer;
        transition: all 0.3s ease;
        pointer-events: auto; /* Re-enable clicks for images */
        opacity: 0.7;
        border: 2px solid transparent;
    }

    .collage-item:hover {
        opacity: 1;
        transform: scale(1.05);
    }

    .collage-item.selected {
        border-color: rgba(255, 255, 255, 0.8);
        opacity: 1;
    }

    .name-form {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        padding: 2em;
        border-radius: 8px;
        display: none;
        text-align: center;
        pointer-events: auto;
    }

    .name-form.visible {
        display: block;
        animation: fadeIn 0.5s ease;
    }

    .name-form input {
        background: transparent;
        border: none;
        border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        font-size: 1.2em;
        padding: 0.5em;
        margin: 1em 0;
        width: 100%;
        outline: none;
    }

    .name-form input:focus {
        border-bottom-color: rgba(255, 255, 255, 0.8);
    }

    .name-form button {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        padding: 0.8em 1.5em;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    .name-form button:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translate(-50%, -40%); }
        to { opacity: 1; transform: translate(-50%, -50%); }
    }
</style>

<div class="collage-container" id="collage"></div>

<form class="name-form" id="nameForm">
    <h2>Enter your name</h2>
    <input type="text" id="nameInput" placeholder="Your legal name" required>
    <button type="submit">Continue</button>
</form>

<script defer>
    const lines = [
        "Touch the images that spark the most curiosity in you.",
        "Please enter your legal name. You may re-use your existing name.",
        "Standard process is letting the mycelium work with your remains.",
        "The interactions model the sparks between the neurons.",
        "You've opted into the alpha release and we will be using the flight trajectories of these birds.",
        "Decide which one your intuition says is yours.",
        "Please call back to them.",
        "Breathe in, breathe out (malayalam buddhism meditation exercise)",
        "Eat the honey from the bees to moderate your state.",
        "This current state has been saved.",
        "We have targeted this flock and blown them 0.3 degrees southeast",
        "Other adjustments to the ecosystem include an increase of soil acidity by 0.03% and diversifying the bacteria in their resting grounds.",
        "Their state is now equivalent to yours.",
        "[name] will live on at [latlong (link to the google maps view)].",
        "The sun is rising. Exit the machine",
        "Subscribe to see how [] solves new problems.",
    ]

    const images = [
        { src: '/static/images/collage/1.jpg', width: '200px', top: '10%', left: '15%' },
        { src: '/static/images/collage/2.jpg', width: '150px', top: '30%', left: '40%' },
        { src: '/static/images/collage/3.jpg', width: '180px', top: '60%', left: '20%' },
        { src: '/static/images/collage/4.jpg', width: '220px', top: '25%', left: '70%' },
        { src: '/static/images/collage/5.jpg', width: '160px', top: '50%', left: '60%' },
        { src: '/static/images/collage/6.jpg', width: '190px', top: '75%', left: '45%' },
        // Add more images with different positions
    ];

    document.addEventListener("DOMContentLoaded", () => {
        const collage = document.getElementById('collage');
        const nameForm = document.getElementById('nameForm');
        let selectedCount = 0;
        
        // Show first caption
        window.captions.show(lines[0]);

        // Create and position images
        images.forEach((img, index) => {
            const div = document.createElement('div');
            div.className = 'collage-item';
            div.style.width = img.width;
            div.style.top = img.top;
            div.style.left = img.left;
            
            const image = document.createElement('img');
            image.src = img.src;
            image.style.width = '100%';
            image.style.height = 'auto';
            
            div.appendChild(image);
            collage.appendChild(div);

            div.addEventListener('click', () => {
                if (!div.classList.contains('selected') && selectedCount < 3) {
                    div.classList.add('selected');
                    selectedCount++;
                    
                    if (selectedCount === 3) {
                        window.captions.show(lines[1]);
                        nameForm.classList.add('visible');
                    }
                }
            });
        });

        // Handle name submission
        nameForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('nameInput').value;
            nameForm.classList.remove('visible');
            
            // Continue with the rest of the captions
            for (let i = 2; i < lines.length; i++) {
                let text = lines[i].replace('[name]', name);
                window.captions.show(text);
            }
        });
    });
</script>
{% endblock %}